---
title: "Data Science Project EDA"
author: "Kaylee Davis"
date: "2023-10-25"
output: html_document
---

<!--
DH general comments: 
- Like the use of renv and an Rproj file
- Missing a README to give the reviewer some context
- Serious issues with violating immutability and data management
- An EDA still needs to have a narrative structure: introducing the reviewer to the research question and dataset and walking through an exploration of it.  Think of it as giving us a guided tour of the data. 
-->

# Research Questions #

<!-- DH: Note that this isn't formatted as a list when you knit to HTML -->
Q1: Whether age-group affects appraisals of technology
Q2: Whether income-level negatively affects an individuals appraisals of technology (lower = more neg)

# Setup # 

<!-- DH: In an ordinary run of the script, `renv` stuff is handled automatically by `.Rprofile`.  Move this to setup instructions in a README. 
```{r}
library(renv)
# Using renv restore function to get dependencies 
restore()
```
--> 

# Read in data #
<!-- DH: What is this dataset we're going to be looking at? -->
```{r}
library(readr)
library(here)

## DH: Hard-wrap long lines
## DH: Spacing after commas
SurveyData <- read_csv(here("data", "SurveyData.csv"), 
                       show_col_types = FALSE)
```

# Check the packaging #
```{r}
## DH: Put all of your `library()` calls at the top of the script. 
##     Often we have a section or at least chunk for this kind of setup. 
library(skimr)

skim(SurveyData)
```

107 rows, 33 columns 
Data is 100% complete, no concern over missing values 


# Look at the top and the bottom of the data #
```{r}
## DH: You only need to call `library()` once per package
library(skimr)

if (interactive()) {
  View(head(SurveyData))
  View(tail(SurveyData))
  View(SurveyData)
}
```

<!-- DH: Anything notable here, either good or bad?  -->


## Created Variables and Relevant Overview Plots ##
```{r}
library(ggplot2)

# Age distribution Histogram
ggplot(SurveyData, aes(x = Age)) +
  geom_histogram(
    bins = 20,
    fill = "blue",
    color = "black",
    alpha = 0.7
  ) +
  labs(x = "Age", y = "Count", title = "Distribution of Respondents' Age") +
  theme_minimal()
```

<!-- DH: Anything notable here?   -->

```{r}
library(ggplot2)
library(dplyr)

# Gender distribution pie chart
SurveyData %>%
  count(Gender) %>%
  ggplot(aes(x = "", y = n, fill = Gender)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Pastel1") +
  theme_void() +
  labs(title = "Gender Distribution") +
  geom_text(aes(label = scales::percent(n / sum(n), accuracy = 0.1)),
    position = position_stack(vjust = 0.5)
  )
```

<!-- DH: Do you know how gender was attributed?  -->

```{r}
# Calculating mean and median age
mean_age <-
  mean(SurveyData$Age, na.rm = TRUE) # na.rm = TRUE ensures that NA values are removed
median_age <- median(SurveyData$Age, na.rm = TRUE)

cat(sprintf("Mean Age: %.2f, Median Age: %.2f", mean_age, median_age))
```

```{r}
library(ggplot2)

# Histogram plot of Age with color based on Gender
SurveyData$Gender <- factor(SurveyData$Gender, levels = c("Male", "Female"))

ggplot(data = SurveyData, aes(x = Age, fill = Gender)) +
  geom_histogram(
    position = "stack",
    binwidth = 3,
    colour = "grey"
  ) +
  labs(title = "Number of Male and Female by Age") +
  theme_minimal()
```


## Income Category Variable Created ##
```{r}
# Define labels for the income categories
breaks <- c(0, 200000, 600000, 1200000, 2000000, Inf)
labels <-
  c(
    "Low Income",
    "Lower-Middle Income",
    "Middle-Middle Income",
    "Upper-Middle Income",
    "High Income"
  )

# Create the IncomeCategory variable
## DH: Violates immutability
SurveyData$IncomeCategory <-
  cut(
    SurveyData$HouseholdIncome,
    breaks = breaks,
    labels = labels,
    include.lowest = TRUE
  )

# add var to the dataframe
## DH: I guess you're writing this to a different folder so you avoid overwriting and potentially corrupting your raw data.  But then this creates clutter and confusion.  How do I, the person reviewing your code, know which `SurveyData.csv` is which? 
write.csv(SurveyData, "SurveyData.csv", row.names = FALSE)
```


## Variable for TotalTechConcern Created ##
```{r}
library(dplyr)

# TotalTechConcern calculated by summing all columns that start with 'Risk'
## DH: Violates immutability
## DH: This calculation ends up difficult to read. Look at `c_across` for a simpler way to do this.
SurveyData <- SurveyData %>%
  mutate(TotalTechConcern = rowSums(select(., starts_with("Risk"))))

# add var to the dataframe
## DH: Repeatedly overwriting your output dataset is a good way to corrupt it.  Consider what happens if someone runs chunks out of order or only runs certain chunks but not others.  Save this until the very end.  
write.csv(SurveyData, "SurveyData.csv", row.names = FALSE)
```

## Variable for TotalTechBenefit Created ##

<!-- DH: DRY: You're doing the same basic thing multiple times: given a set of columns, take the rowwise sum and use that as an aggregate variable.  Use `c_across()` or a custom function to make this easier to read, and do it in a single `mutate()` call so that you don't need to keep violating impredicativity.  -->
```{r}
library(dplyr)

# Calculate the TotalTechBenefit by summing all columns that start with 'Benefit'
SurveyData <- SurveyData %>%
  mutate(TotalTechBenefit = rowSums(select(., starts_with("Benefit")), na.rm = TRUE))

# add var to the dataframe
write.csv(SurveyData, "SurveyData.csv", row.names = FALSE)
```


## Plots that look at the questions ##

<!-- DH: Note that the line break doesn't appear in the HTML. Use Markdown headers to get the formatting right. -->
Plotting the correlation between Age and TotalTechConcern
    Relevant Question: Does age-group affect appraisals of technology?

```{r}
library(ggplot2)

ggplot(data = SurveyData, aes(x = Age, y = TotalTechConcern)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", color = "blue") +
  labs(
    x = "Age", y = "Total Tech Concern",
    title = "Correlation between Age and Total Tech Concern"
  ) +
  theme_minimal()

# Calculate and print the correlation coefficient
## DH: Didn't you say above that there were no missing values? 
correlation <-
  cor.test(SurveyData$Age, 
           SurveyData$TotalTechConcern, 
           use = "complete.obs") # use handles missing values
print(correlation)
```
 


## Plotting the relationship between IncomeCategory and TotalTechConcern ##
     Relevant Question: Whether income-level negatively affects an individuals appraisals of technology (lower = more neg)
    
```{r}
library(ggplot2)

ggplot(data = SurveyData, aes(x = IncomeCategory, 
                              y = TotalTechConcern)) +
    ## DH: With so few observations, consider a dotplot or 
    ##     beeswarm: https://github.com/eclarke/ggbeeswarm
  geom_boxplot() +
  labs(
    x = "Income Category", y = "Total Tech Concern",
    title = "Total Tech Concern across Income Categories"
  ) +
  theme_minimal()

# ANOVA to test if differences in TotalTechConcern are statistically significant across IncomeCategory
anova_result <- aov(TotalTechConcern ~ IncomeCategory, 
                    data = SurveyData)
summary(anova_result)
```
# Results & Follow up 

<!-- DH: You didn't include age in the ANOVA.  Could also include gender to account for the gender imbalance. -->
P > 0.05 (No significant effect) for both observations. Therefore, income-level and age-group does not correlate with an individuals appraisals of technology. 
<!-- DH: Remember that you can't accept the null in Fisherian statistics, and Neyman-Pearson requires a power analysis. -->

Problem of Gender Imbalance: To counter the overrepresentation of male participants, future iterations of the survey could aim for a more balanced gender representation.

Diversifying Geographic Representation: The data is gathered from participants residing in India. As a result, generalizability is called into question. Conducting the survey in different countries or regions would provide comparative insights and reveal whether the trends observed are specific to India or more universally applicable. 

Fit for Purpose: The data aligns well with the specific research questions I have, however, the sample representativeness is a weak point of the data. generalizability is not possible with this data, therefore, it is not fit for purpose. Regardless, the data provides a good starting point.  





